
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>COVID-19 Toll Converter</title>
    <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    <style>
        .header{
            margin: 20px 10% 20px;
            font-family: "Hiragino Sans","Meiryo UI","游ゴシック Medium","Yu Gothic Medium","sans-serif";
        }    
        .contentStyleWrapper {
            display: flex; 
            flex-direction: column;
            align-items: center;
            font-family: "Hiragino Sans","Meiryo UI","游ゴシック Medium","Yu Gothic Medium","sans-serif";
            font-size: 12px;
        }
        .textInput {
            width: 80vw;
            height: 50vh;
            margin-bottom: 10px;
        }
        .submitButton {
            width: fit-content;
        }
        .output {        
            margin: 2em auto;
            padding: 1em;
            width: 78vw;
            border: 1px solid #ccc;
        }
        .mark1 {
            background: linear-gradient(transparent 0%, #f6ff5f 0%);
        }
        .mark2 {
            background: linear-gradient(transparent 0%, #fe81cc 0%);
        }
    </style>
    <body>
        <script>
            const clickHandler = () => {
                const story = document.getElementById("textInput").value;
                const paragraphs = story.split("\n\n");

                const getPureNumbers = paragraphIndex => {
                    const paragraphX = paragraphs[paragraphIndex].split(" ");
                    const paragraphXNumbers = paragraphX.filter(word => RegExp(/[0-9]+/g).test(word));
                    return paragraphXNumbers.map(number => number.replace(/[^0-9]/g, ""));
                };

                const ketaAdder = pureNumbers => {
                    return pureNumbers.map(function(number) {
                    if(number.length < 5) {
                        return number;
                        } else if(number.length >= 5 && number.length < 9) {
                            const insertManAt = number.length - 4;
                            const stringifiedNumber = String(number);
                            return stringifiedNumber.slice(0, insertManAt).concat("万").concat(Number(stringifiedNumber.slice(insertManAt)));
                        } else if(number.length >=9 && number.length <13) {
                            const insertOkuAt = number.length - 8;
                            const insertManAt = number.length - 4;
                            const stringifiedNumber = String(number);
                            return stringifiedNumber.slice(0, insertOkuAt).concat("億").concat(Number(stringifiedNumber.slice(0, insertManAt))).concat("万").concat(Number(stringifiedNumber.slice(insertManAt)));
                        } else {
                            return "※エラー：1兆を超える数字には対応していません";
                        }
                    })
                };

                const countryTranslator = paragraphIndex => {
                    const countries = ["États-Unis", "États-Unis,", "Brésil", "l'Inde", "Belgique", "Pérou", "l'Espagne", "Royaume-Uni", "l'Italie", "Chine", "Mexique", "Chili", "Colombie", "France", "l'Iran", "Russie", "l'Afrique", "l'Argentine", "Bolivie"];
                    const translations = {
                        "États-Unis": "米国",
                        "États-Unis,": "米国",
                        "Brésil": "ブラジル",
                        "l'Inde": "インド",
                        "Belgique": "ベルギー",
                        "Pérou": "ペルー",
                        "l'Espagne": "スペイン",
                        "Royaume-Uni": "英国",
                        "l'Italie": "イタリア",
                        "Chine": "中国",
                        "Mexique": "メキシコ",
                        "Chili": "チリ",
                        "Colombie": "コロンビア",
                        "France": "フランス",
                        "l'Iran": "イラン",
                        "Russie": "ロシア",
                        "l'Afrique": "南アフリカ",
                        "l'Argentine": "アルゼンチン",
                        "Bolivie": "ボリビア"
                        };
                    const paragraphX = paragraphs[paragraphIndex].split(" ");
                    const paragraphXCountries = paragraphX.filter(word => countries.includes(word));
                    return paragraphXCountries.map(country => translations[country]);
                };
                
                const regionTranslator = paragraphIndex => {
                    const regions = ["Latine", "latine", "l'Europe", "Canada", "l'Asie", "Moyen-Orient", "l'Afrique", "l'Océanie"];
                    const regionTranslations = {
                        "Latine": "中南米・カリブ海（%%Caribbean Sea%%）諸国",
                        "latine": "中南米・カリブ海（%%Caribbean Sea%%）諸国",
                        "l'Europe": "欧州",
                        "Canada": "米国・カナダ",
                        "l'Asie": "アジア",
                        "Moyen-Orient": "中東",
                        "l'Afrique": "アフリカ",
                        "l'Océanie": "オセアニア"
                        };
                    const paragraphX = paragraphs[paragraphIndex].split(" ");
                    const paragraphXRegions = paragraphX.filter(word => regions.includes(word));
                    return paragraphXRegions.map(region => regionTranslations[region]);
                };

                const infoWords = paragraphs[0].split("\n")[2].split(" ");
                const infoNumbers = infoWords.filter(word => RegExp(/[0-9]+/g).test(word));
                const dateParts = infoNumbers[0].split("/");
                const publishedDate = new Date(dateParts[2], dateParts[1]-1, dateParts[0]);
                const dayBeforePublishedDate = new Date (publishedDate - 1);
                const todayInJapan = new Date ((new Date()).getTime() + (new Date()).getTimezoneOffset()*60*1000 + 9*60*60*1000);

                const createParagraph = (outputNumber, paragraph) => document.getElementById(`output${outputNumber}`).innerHTML = paragraph;

            // Headline & 1st paragraph                
                const paragraph1PureNumbers = getPureNumbers(1);
                const paragraph1Ketas = ketaAdder(paragraph1PureNumbers);
                    createParagraph(0, `新型コロナウイルス、現在の感染者・死者数（<span class="mark1">${publishedDate.getDate()}</span>日午後8時時点） 死者<span class="mark1">${Math.floor((paragraph1PureNumbers[0]/Math.pow(10,4))*Math.pow(10, 1))/Math.pow(10,1)}万</span>人に`);
                    createParagraph(1, `【<span class="mark1">${todayInJapan.getMonth()+1}</span>月<span class="mark1">${todayInJapan.getDate()}</span>日 AFP】AFPが各国当局の発表に基づき日本時間<span class="mark1">${publishedDate.getDate()}</span>日午後8時にまとめた統計によると、世界の新型コロナウイルスによる死者数は<span class="mark1">${paragraph1Ketas[0]}</span>人に増加した。`);


            // 2nd paragraph
                const paragraph2PureNumbers = getPureNumbers(2);
                const paragraph2Ketas = ketaAdder(paragraph2PureNumbers);

                if(paragraph2PureNumbers.length === 2){
                    createParagraph(2, `　中国で昨年12月末に新型ウイルスが最初に発生して以降、これまでに196の国・地域で少なくとも<span class="mark1">${paragraph2Ketas[0]}</span>人の感染が確認され、少なくとも<span class="mark1">${paragraph2Ketas[1]}</span>人が回復した。`);
                    } else if(paragraph2PureNumbers.length === 3){
                        createParagraph(2, `　中国で昨年12月末に新型ウイルスが最初に発生して以降、これまでに196の国・地域で少なくとも<span class="mark1">${paragraph2Ketas[0]}</span>人の感染が確認され、少なくとも<span class="mark1">${paragraph2Ketas[2]}</span>人が回復した。`);                    
                    } else {
                        createParagraph(2, `　中国で昨年12月末に新型ウイルスが最初に発生して以降、これまでに196の国・地域で少なくとも〓万〓〓〓〓（←※エラー：2パラを修正してください）人の感染が確認され、少なくとも〓万〓〓〓〓（←※エラー：2パラを修正してください）人が回復した。`);
                    };            

            // 3rd paragraph
                createParagraph(3, `　この統計は、各地のAFP支局が各国当局から収集したデータと世界保健機関（%%WHO%%）からの情報に基づいたもので、実際の感染者はこれよりも多いとみられる。多くの国では、症状がある人や重症患者にのみ検査を実施している。`);

            // 4th paragraph
                const paragraph4PureNumbers = getPureNumbers(4);
                const paragraph4Ketas = ketaAdder(paragraph4PureNumbers);
                const top3Countries = countryTranslator(4);

                if(paragraph4PureNumbers.length === 5){
                    createParagraph(4, `　<span class="mark1">${dayBeforePublishedDate.getDate()}</span>日には世界全体で新たに<span class="mark1">${paragraph4Ketas[0]}</span>人の死亡と<span class="mark1">${paragraph4Ketas[1]}</span>人の新規感染が発表された。死者の増加幅が最も大きいのは<span class="mark2">${top3Countries[0]}</span>の<span class="mark1">${paragraph4Ketas[2]}</span>人。次いで<span class="mark2">${top3Countries[1]}</span>（<span class="mark1">${paragraph4Ketas[3]}</span>人）、<span class="mark2">${top3Countries[2]}</span>（<span class="mark1">${paragraph4Ketas[4]}</span>人）となっている。`);
                    } else {
                        createParagraph(4, `　<span class="mark1">${dayBeforePublishedDate.getDate()}</span>日には世界全体で新たに〓〓〓〓人の死亡と〓万〓〓〓〓人の新規感染が発表された。死者の増加幅が最も大きいのは<span class="mark2">${top3Countries[0]}</span>の〓〓〓人。次いで<span class="mark2">${top3Countries[1]}</span>（〓〓〓人）、<span class="mark2">${top3Countries[2]}</span>（〓〓〓人）となっている。（←※エラー：4パラを修正してください）`);
                    };            

            // 5th paragraph
                const paragraph5PureNumbers = getPureNumbers(5);
                const paragraph5Ketas = ketaAdder(paragraph5PureNumbers);
                const topCountry = countryTranslator(5);

                if(paragraph5PureNumbers.length === 3){
                    createParagraph(5, `　最も被害が大きい<span class="mark2">${topCountry}</span>では、これまでに<span class="mark1">${paragraph5Ketas[0]}</span>人が死亡、<span class="mark1">${paragraph5Ketas[1]}</span>人が感染し、少なくとも<span class="mark1">${paragraph5Ketas[2]}</span>人が回復した。`);
                    } else {
                        createParagraph(5, `　最も被害が大きい<span class="mark2">${topCountry}</span>では、これまでに〓〓万〓〓〓〓人が死亡、〓〓〓万〓〓〓〓人が感染し、少なくとも〓〓〓万〓〓〓〓人が回復した。（←※エラー：5パラを修正してください）`);
                    };

            // 6th paragraph
                const paragraph6PureNumbers = getPureNumbers(6);
                const paragraph6Ketas = ketaAdder(paragraph6PureNumbers);
                const top5Countries = countryTranslator(6);

                if(paragraph6PureNumbers.length === 8){
                    createParagraph(6, `　次いで被害が大きい国は<span class="mark2">${top5Countries[1]}</span>で、死者数は<span class="mark1">${paragraph6Ketas[0]}</span>人、感染者数は<span class="mark1">${paragraph6Ketas[1]}</span>人。以降は<span class="mark2">${top5Countries[2]}</span>（死者<span class="mark1">${paragraph6Ketas[2]}</span>人、感染者<span class="mark1">${paragraph6Ketas[3]}</span>人）、<span class="mark2">${top5Countries[3]}</span>（死者<span class="mark1">${paragraph6Ketas[4]}</span>人、感染者<span class="mark1">${paragraph6Ketas[5]}</span>人）、<span class="mark2">${top5Countries[4]}</span>（死者<span class="mark1">${paragraph6Ketas[6]}</span>人、感染者<span class="mark1">${paragraph6Ketas[7]}</span>人）となっている。`);
                    } else {
                        createParagraph(6, `　次いで被害が大きい国は<span class="mark2">${top5Countries[1]}</span>で、死者数は〓〓万〓〓〓〓人、感染者数は〓〓〓万〓〓〓〓人。以降は<span class="mark2">${top5Countries[2]}</span>（死者〓万〓〓〓〓人、感染者〓〓万〓〓〓〓人）、<span class="mark2">${top5Countries[3]}</span>（死者〓万〓〓〓〓人、感染者〓〓〓万〓〓〓〓人）、<span class="mark2">${top5Japanese[4]}</span>（死者〓万〓〓〓〓人、感染者〓〓万〓〓〓〓人）となっている。（←※エラー：6パラを修正してください）`);
                    };    

            // 7th paragraph
                const paragraph7 = paragraphs[7].split(" ");
                const paragraph7Numbers = paragraph7.filter(word => RegExp(/[0-9]+/g).test(word));
                const paragraph7PureNumbers = paragraph7Numbers.map(number => number.replace(/(,)$/g, "").replace(".", "").replace(",", ".").replace("(", "").replace(")", ""));
                const paragraph7Ketas = ketaAdder(paragraph7PureNumbers);
                const highFatalityCountries = countryTranslator(7);

                if(paragraph7PureNumbers.length === 6){
                    createParagraph(7, `　人口10万人当たりの死者数が最も多いのは<span class="mark2">${highFatalityCountries[0]}</span>の<span class="mark1">${paragraph7Ketas[0]}</span>人。次いで<span class="mark2">${highFatalityCountries[1]}</span>（<span class="mark1">${paragraph7Ketas[2]}</span>人）、<span class="mark2">${highFatalityCountries[2]}</span>（<span class="mark1">${paragraph7Ketas[3]}</span>人）、<span class="mark2">${highFatalityCountries[3]}</span>（<span class="mark1">${paragraph7Ketas[4]}</span>人）、<span class="mark2">${highFatalityCountries[4]}</span>（<span class="mark1">${paragraph7Ketas[5]}</span>人）となっている。`);
                    } else if (paragraph7PureNumbers.length === 5) {
                        createParagraph(7, `　人口10万人当たりの死者数が最も多いのは<span class="mark2">${highFatalityCountries[0]}</span>と<span class="mark2">${highFatalityCountries[1]}</span>の<span class="mark1">${paragraph7Ketas[0]}</span>人。次いで<span class="mark2">${highFatalityCountries[2]}</span>（<span class="mark1">${paragraph7Ketas[2]}</span>人）、<span class="mark2">${highFatalityCountries[3]}</span>（<span class="mark1">${paragraph7Ketas[3]}</span>人）、<span class="mark2">${highFatalityCountries[4]}</span>（<span class="mark1">${paragraph7Ketas[4]}</span>人）となっている。`);
                    } else {
                        createParagraph(7, `　人口10万人当たりの死者数が最も多いのは<span class="mark2">${highFatalityCountries[0]}</span>の〓〓人。次いで<span class="mark2">${highFatalityCountries[1]}</span>（〓〓人）、<span class="mark2">${highFatalityCountries[2]}</span>（〓〓人）、<span class="mark2">${highFatalityCountries[3]}</span>（〓〓人）、<span class="mark2">${highFatalityCountries[4]}</span>（〓〓人）となっている。（←※エラー：7パラを修正してください）`);
                    };

            // 8th paragraph
                const paragraph8PureNumbers = getPureNumbers(8);
                const paragraph8Ketas = ketaAdder(paragraph8PureNumbers);

                if(paragraph8PureNumbers.length === 5){
                    createParagraph(8, `　香港とマカオ（%%Macau%%）を除く中国本土で発表された死者数は<span class="mark1">${paragraph8Ketas[2]}</span>人、感染者数は<span class="mark1">${paragraph8Ketas[0]}</span>人、回復者数は<span class="mark1">${paragraph8Ketas[4]}</span>人。`);
                    } else if(paragraph8PureNumbers.length === 4) {
                        createParagraph(8, `　香港とマカオ（%%Macau%%）を除く中国本土で発表された死者数は<span class="mark1">${paragraph8Ketas[2]}</span>人、感染者数は<span class="mark1">${paragraph8Ketas[0]}</span>人、回復者数は<span class="mark1">${paragraph8Ketas[3]}</span>人。`);
                    } else if(paragraph8PureNumbers.length === 3) {
                        createParagraph(8, `　香港とマカオ（%%Macau%%）を除く中国本土で発表された死者数は<span class="mark1">${paragraph8Ketas[1]}</span>人、感染者数は<span class="mark1">${paragraph8Ketas[0]}</span>人、回復者数は<span class="mark1">${paragraph8Ketas[2]}</span>人。`);
                    } else {
                        createParagraph(8, `　香港とマカオ（%%Macau%%）を除く中国本土で発表された死者数は〓〓〓〓人、感染者数は〓万〓〓〓〓人、回復者数は〓万〓〓〓〓人。（←※エラー：8パラを修正してください）`);
                    };


            // 9th paragraph
                const paragraph9PureNumbers = getPureNumbers(9);
                const paragraph9Ketas = ketaAdder(paragraph9PureNumbers);
                const orderedRegions = regionTranslator(9);

                if(paragraph9PureNumbers.length === 15){
                    createParagraph(9, `　地域別の死者数は、<span class="mark2">${orderedRegions[0]}</span>が<span class="mark1">${paragraph9Ketas[1]}</span>人（感染<span class="mark1">${paragraph9Ketas[2]}</span>人）、<span class="mark2">${orderedRegions[1]}</span>が<span class="mark1">${paragraph9Ketas[3]}</span>人（感染<span class="mark1">${paragraph9Ketas[4]}</span>人）、<span class="mark2">${orderedRegions[2]}</span>が<span class="mark1">${paragraph9Ketas[5]}</span>人（感染<span class="mark1">${paragraph9Ketas[6]}</span>人）、<span class="mark2">${orderedRegions[3]}</span>が<span class="mark1">${paragraph9Ketas[7]}</span>人（感染<span class="mark1">${paragraph9Ketas[8]}</span>人）、<span class="mark2">${orderedRegions[4]}</span>が<span class="mark1">${paragraph9Ketas[9]}</span>人（感染<span class="mark1">${paragraph9Ketas[10]}</span>人）、<span class="mark2">${orderedRegions[5]}</span>が<span class="mark1">${paragraph9Ketas[11]}</span>人（感染<span class="mark1">${paragraph9Ketas[12]}</span>人）、<span class="mark2">${orderedRegions[6]}</span>が<span class="mark1">${paragraph9Ketas[13]}</span>人（感染<span class="mark1">${paragraph9Ketas[14]}</span>人）となっている。`);
                    } else if (paragraph9PureNumbers.length === 14) {
                        createParagraph(9, `　地域別の死者数は、<span class="mark2">${orderedRegions[0]}</span>が<span class="mark1">${paragraph9Ketas[0]}</span>人（感染<span class="mark1">${paragraph9Ketas[1]}</span>人）、<span class="mark2">${orderedRegions[1]}</span>が<span class="mark1">${para9Ketas[2]}</span>人（感染<span class="mark1">${para9Ketas[3]}</span>人）、<span class="mark2">${orderedRegions[2]}</span>が<span class="mark1">${para9Ketas[4]}</span>人（感染<span class="mark1">${para9Ketas[5]}</span>人）、<span class="mark2">${orderedRegions[3]}</span>が<span class="mark1">${para9Ketas[6]}</span>人（感染<span class="mark1">${para9Ketas[7]}</span>人）、<span class="mark2">${orderedRegions[4]}</span>が<span class="mark1">${para9Ketas[8]}</span>人（感染<span class="mark1">${para9Ketas[9]}</span>人）、<span class="mark2">${orderedRegions[5]}</span>が<span class="mark1">${para9Ketas[10]}</span>人（感染<span class="mark1">${para9Ketas[11]}</span>人）、<span class="mark2">${orderedRegions[6]}</span>が<span class="mark1">${para9Ketas[12]}</span>人（感染<span class="mark1">${para9Ketas[13]}</span>人）となっている。`);
                    } else {
                        createParagraph(9, `　地域別の死者数は、<span class="mark2">${orderedRegions[0]}</span>が〓〓万〓〓〓〓人（感染〓〓〓万〓〓〓〓人）、<span class="mark2">${orderedRegionsJapanese[1]}</span>が〓〓万〓〓〓〓人（感染〓〓〓万〓〓〓〓人）、<span class="mark2">${orderedRegionsJapanese[2]}</span>が〓〓万〓〓〓〓人（感染〓〓〓万〓〓〓〓人）、<span class="mark2">${orderedRegionsJapanese[3]}</span>が〓万〓〓〓〓人（感染〓〓〓万〓〓〓〓人）、<span class="mark2">${orderedRegionsJapanese[4]}</span>が〓万〓〓〓〓人（感染〓〓〓万〓〓〓〓人）、<span class="mark2">${orderedRegionsJapanese[5]}</span>が〓万〓〓〓〓人（感染〓〓〓万〓〓〓〓人）、<span class="mark2">${orderedRegionsJapanese[6]}</span>が〓〓〓人（感染〓万〓〓〓〓人）となっている。（←※エラー：9パラを修正してください）`);
                    };

            // 10th paragraph
                createParagraph(10, `　各国の死者数・感染者数は当局による訂正やデータ公表の遅れがあるため、過去24時間での増加幅は前日の集計結果との差と一致しない場合がある。(c)AFP`);
            };
            
            const copyToClipboard = () => {
                const copyTarget = document.getElementById("japanese");
                let range = document.createRange();
                range.selectNodeContents(copyTarget);
                let selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                document.execCommand("copy");
                alert("クリップボードにコピーしました");
                selection.removeAllRanges();
            };

        </script>
        <h4 class = "header">仏語（タイトルと本文〈10パラ〉）をペーストしてください</h4>
        <div class="contentStyleWrapper">
            <textarea id="textInput" class="textInput" name="text" placeholder="Paste the French version here..."></textarea>
            <br><button type="button" class="submitButton" onclick="clickHandler()">日本語版を表示</button>
            <div class = "output">
                <button type="button" class="copyButton" onclick="copyToClipboard()" data-toggle="tooltip" data-placement="top" title="コピーする">
                    <i class="far fa-copy"></i>
                </button>
            <div id = "japanese">
            <p id="output0"></p>
            <p id="output1"></p>
            <p id="output2"></p>
            <p id="output3"></p>
            <p id="output4"></p>
            <p id="output5"></p>
            <p id="output6"></p>
            <p id="output7"></p>
            <p id="output8"></p>
            <p id="output9"></p>
            <p id="output10"></p>
            </div></div>
        </div><br><br><br><br>
    </body>
</html>
